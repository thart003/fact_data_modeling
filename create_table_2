CREATE TABLE taylorhart.daily_web_metrics (
  user_id BIGINT,
  metric_name VARCHAR,
  metric_value BIGINT,
  date DATE
) WITH (
  format = 'PARQUET',
  partitioning = ARRAY['metric_name', 'date']
)



INSERT INTO taylorhart.daily_web_metrics

SELECT 
  user_id,
  'visited_home_page' as metric_name,
  COUNT(CASE WHEN url = '/' THEN 1 END) as metric_value,
  CAST(event_time AS DATE) as date
FROM taylorhart.web_events
GROUP BY user_id, CAST(event_time AS DATE)


CREATE TABLE taylorhart.monthly_array_metrics (
  user_id BIGINT,
  metric_name VARCHAR,
  metric_array ARRAY(INTEGER),
  month_start VARCHAR
) WITH (
  format = 'PARQUET',
  partitioning = ARRAY['metric_name', 'month_start']
